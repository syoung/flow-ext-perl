<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../../displayToc.js"></script>
<script language="JavaScript" src="../../../../tocParas.js"></script>
<script language="JavaScript" src="../../../../tocTab.js"></script>
<title></title>
<link rel="stylesheet" href="../../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:support@ActiveState.com" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#WHERES-THE-CONSTRUCTOR">WHERE&#39;S THE CONSTRUCTOR?</a></li>
  <li><a href="#OBJECT-CONSTRUCTION-AND-ATTRIBUTES">OBJECT CONSTRUCTION AND ATTRIBUTES</a></li>
  <li><a href="#OBJECT-CONSTRUCTION-HOOKS">OBJECT CONSTRUCTION HOOKS</a>
    <ul>
      <li><a href="#BUILDARGS">BUILDARGS</a></li>
      <li><a href="#BUILD">BUILD</a>
        <ul>
          <li><a href="#BUILD-and-parent-classes">BUILD and parent classes</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#OBJECT-DESTRUCTION">OBJECT DESTRUCTION</a>
    <ul>
      <li><a href="#Error-Handling-During-Destruction">Error Handling During Destruction</a></li>
    </ul>
  </li>
  <li><a href="#AUTHORS">AUTHORS</a></li>
  <li><a href="#COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Moose::Manual::Construction - Object construction (and destruction) with Moose</p>

<h1 id="VERSION">VERSION</h1>

<p>version 2.2012</p>

<h1 id="WHERES-THE-CONSTRUCTOR">WHERE&#39;S THE CONSTRUCTOR?</h1>

<p><b>Do not define a <code>new()</code> method for your classes!</b></p>

<p>When you <code>use Moose</code> in your class, your class becomes a subclass of <a href="../../../../lib/perl5/5.26.3/x86_64-linux-thread-multi/Moose/Object.html">Moose::Object</a>. The <a href="../../../../lib/perl5/5.26.3/x86_64-linux-thread-multi/Moose/Object.html">Moose::Object</a> provides a <code>new()</code> method for your class. If you follow our recommendations in <a href="../../../../lib/perl5/5.26.3/x86_64-linux-thread-multi/Moose/Manual/BestPractices.html">Moose::Manual::BestPractices</a> and make your class immutable, then you actually get a class-specific <code>new()</code> method &quot;inlined&quot; in your class.</p>

<h1 id="OBJECT-CONSTRUCTION-AND-ATTRIBUTES">OBJECT CONSTRUCTION AND ATTRIBUTES</h1>

<p>The Moose-provided constructor accepts a hash or hash reference of named parameters matching your attributes (actually, matching their <code>init_arg</code>s). This is just another way in which Moose keeps you from worrying <i>how</i> classes are implemented. Simply define a class and you&#39;re ready to start creating objects!</p>

<h1 id="OBJECT-CONSTRUCTION-HOOKS">OBJECT CONSTRUCTION HOOKS</h1>

<p>Moose lets you hook into object construction. You can validate an object&#39;s state, do logging, customize construction from parameters which do not match your attributes, or maybe allow non-hash(ref) constructor arguments. You can do this by creating <code>BUILD</code> and/or <code>BUILDARGS</code> methods.</p>

<p>If these methods exist in your class, Moose will arrange for them to be called as part of the object construction process.</p>

<h2 id="BUILDARGS">BUILDARGS</h2>

<p>The <code>BUILDARGS</code> method is called as a class method <i>before</i> an object is created. It will receive all of the arguments that were passed to <code>new()</code> <i>as-is</i>, and is expected to return a hash reference. This hash reference will be used to construct the object, so it should contain keys matching your attributes&#39; names (well, <code>init_arg</code>s).</p>

<p>One common use for <code>BUILDARGS</code> is to accommodate a non-hash(ref) calling style. For example, we might want to allow our Person class to be called with a single argument of a social security number, <code>Person-&gt;new($ssn)</code>.</p>

<p>Without a <code>BUILDARGS</code> method, Moose will complain, because it expects a hash or hash reference. We can use the <code>BUILDARGS</code> method to accommodate this calling style:</p>

<pre><code>  around BUILDARGS =&gt; sub {
      my $orig  = shift;
      my $class = shift;

      if ( @_ == 1 &amp;&amp; !ref $_[0] ) {
          return $class-&gt;$orig( ssn =&gt; $_[0] );
      }
      else {
          return $class-&gt;$orig(@_);
      }
  };</code></pre>

<p>Note the call to <code>$class-&gt;$orig</code>. This will call the default <code>BUILDARGS</code> in <a href="../../../../lib/perl5/5.26.3/x86_64-linux-thread-multi/Moose/Object.html">Moose::Object</a>. This method takes care of distinguishing between a hash reference and a plain hash for you.</p>

<h2 id="BUILD">BUILD</h2>

<p>The <code>BUILD</code> method is called <i>after</i> an object is created. There are several reasons to use a <code>BUILD</code> method. One of the most common is to check that the object state is valid. While we can validate individual attributes through the use of types, we can&#39;t validate the state of a whole object that way.</p>

<pre><code>  sub BUILD {
      my $self = shift;

      if ( $self-&gt;country_of_residence eq &#39;USA&#39; ) {
          die &#39;All US residents must have an SSN&#39;
              unless $self-&gt;has_ssn;
      }
  }</code></pre>

<p>Another use of a <code>BUILD</code> method could be for logging or tracking object creation.</p>

<pre><code>  sub BUILD {
      my $self = shift;

      debug( &#39;Made a new person - SSN = &#39;, $self-&gt;ssn, );
  }</code></pre>

<p>The <code>BUILD</code> method is called with the hash reference of the parameters passed to the constructor (after munging by <code>BUILDARGS</code>). This gives you a chance to do something with parameters that do not represent object attributes.</p>

<pre><code>  sub BUILD {
      my $self = shift;
      my $args = shift;

      $self-&gt;add_friend(
          My::User-&gt;new(
              user_id =&gt; $args-&gt;{user_id},
          )
      );
  }</code></pre>

<h3 id="BUILD-and-parent-classes">BUILD and parent classes</h3>

<p>The interaction between multiple <code>BUILD</code> methods in an inheritance hierarchy is different from normal Perl methods. <b>You should never call <code>$self-&gt;SUPER::BUILD</code></b>, nor should you ever apply a method modifier to <code>BUILD</code>. Roles are an exception to this rule, though: it&#39;s completely acceptable to apply a method modifier to <code>BUILD</code> in a role; you can even provide an empty <code>BUILD</code> subroutine in a role so the role is applicable even to classes without their own <code>BUILD</code>.</p>

<p>Moose arranges to have all of the <code>BUILD</code> methods in a hierarchy called when an object is constructed, <i>from parents to children</i>. This might be surprising at first, because it reverses the normal order of method inheritance.</p>

<p>The theory behind this is that <code>BUILD</code> methods can only be used for increasing specialization of a class&#39;s constraints, so it makes sense to call the least specific <code>BUILD</code> method first. Also, this is how Perl 6 does it.</p>

<h1 id="OBJECT-DESTRUCTION">OBJECT DESTRUCTION</h1>

<p>Moose provides a hook for object destruction with the <code>DEMOLISH</code> method. As with <code>BUILD</code>, you should never explicitly call <code>$self-&gt;SUPER::DEMOLISH</code>. Moose will arrange for all of the <code>DEMOLISH</code> methods in your hierarchy to be called, from most to least specific.</p>

<p>Each <code>DEMOLISH</code> method is called with a single argument. This is a boolean value indicating whether or not this method was called as part of the global destruction process (when the Perl interpreter exits).</p>

<p>In most cases, Perl&#39;s built-in garbage collection is sufficient, and you won&#39;t need to provide a <code>DEMOLISH</code> method.</p>

<h2 id="Error-Handling-During-Destruction">Error Handling During Destruction</h2>

<p>The interaction of object destruction and Perl&#39;s global <code>$@</code> and <code>$?</code> variables can be very confusing.</p>

<p>Moose always localizes <code>$?</code> when an object is being destroyed. This means that if you explicitly call <code>exit</code>, that exit code will be preserved even if an object&#39;s destructor makes a system call.</p>

<p>Moose also preserves <code>$@</code> against any <code>eval</code> calls that may happen during object destruction. However, if an object&#39;s <code>DEMOLISH</code> method actually dies, Moose explicitly rethrows that error.</p>

<p>If you do not like this behavior, you will have to provide your own <code>DESTROY</code> method and use that instead of the one provided by <a href="../../../../lib/perl5/5.26.3/x86_64-linux-thread-multi/Moose/Object.html">Moose::Object</a>. You can do this to preserve <code>$@</code> <i>and</i> capture any errors from object destruction by creating an error stack.</p>

<h1 id="AUTHORS">AUTHORS</h1>

<ul>

<li><p>Stevan Little &lt;stevan.little@iinteractive.com&gt;</p>

</li>
<li><p>Dave Rolsky &lt;autarch@urth.org&gt;</p>

</li>
<li><p>Jesse Luehrs &lt;doy@tozt.net&gt;</p>

</li>
<li><p>Shawn M Moore &lt;code@sartak.org&gt;</p>

</li>
<li><p>&#x5D9;&#x5D5;&#x5D1;&#x5DC; &#x5E7;&#x5D5;&#x5D2;&#39;&#x5DE;&#x5DF; (Yuval Kogman) &lt;nothingmuch@woobling.org&gt;</p>

</li>
<li><p>Karen Etheridge &lt;ether@cpan.org&gt;</p>

</li>
<li><p>Florian Ragwitz &lt;rafl@debian.org&gt;</p>

</li>
<li><p>Hans Dieter Pearcey &lt;hdp@weftsoar.net&gt;</p>

</li>
<li><p>Chris Prather &lt;chris@prather.org&gt;</p>

</li>
<li><p>Matt S Trout &lt;mst@shadowcat.co.uk&gt;</p>

</li>
</ul>

<h1 id="COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</h1>

<p>This software is copyright (c) 2006 by Infinity Interactive, Inc.</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>


</body>

</html>


